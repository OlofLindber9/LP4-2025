import matplotlib.pyplot as plt
import numpy as np
import math


estimates = [274799.7987367495, 280650.09451735415, 295201.40148290753, 275253.7004208523, 289182.6095624466, 302431.0455483665, 295513.3574576416, 298472.13383636886, 280210.35578335676, 305786.9876245857, 296264.3775276172, 296705.08995108167, 288350.8991684142, 281560.6406744655, 275578.09897650697, 289116.2823681731, 281825.06238149595, 281599.4715450028, 284502.87567919196, 306054.9949939895, 281547.13244458346, 292540.9217758071, 287665.3176425726, 268841.8106989377, 272323.4864253383, 288187.8983873052, 281263.9521950409, 274760.747779567, 294921.89741973014, 281756.80607868254, 284688.1822040798, 273207.9475207158, 289778.01181127824, 296872.0858917414, 286652.370547259, 289390.91739532386, 260846.3983982691, 273435.6707082543, 281471.61030609935, 291743.08779496653, 273260.3185357674, 264548.3383955251, 289207.3119493682, 297315.5021483545, 271000.11033766327, 281415.8199766771, 279495.08822002687, 277838.81805371214, 273641.65508208284, 296131.8766000735, 280947.1761628502, 281542.98017511837, 288371.99574913556, 289074.77080394386, 282171.5639982638, 281777.1492120204, 292508.89656303, 282010.4532787977, 275033.072674165, 281585.259004454, 279386.12513704813, 302350.1438820239, 290171.031960164, 281182.28829023143, 292062.1938800108, 285844.72136399255, 272147.7811038517, 291360.64040761115, 287861.9783757759, 294582.2201496485, 288973.54735437623, 275122.94851834123, 275270.54482046235, 275248.35702857026, 285683.097841959, 289515.9192460355, 297282.7019745306, 278549.1973990433, 292580.780816472, 274823.082105145, 294239.7727552235, 282034.1463043573, 284399.3596915721, 295451.4217452771, 283062.89538910514, 290566.61161346, 279105.50936165435, 291066.64229423227, 278557.62020949455, 289082.7873563682, 280876.6059031664, 287157.63855606224, 298017.52801112155, 273965.8512439911, 295434.77130860783, 274216.6685974627, 279883.38308511476, 286598.4475112728, 288213.4271952651, 290400.32515655184, 281288.72465507296, 305935.6257290278, 316609.9443255321, 276649.634673132, 275323.35084678413, 292673.09317915863, 283882.95213008934, 296980.2553927826, 272507.4562493495, 294792.4316505226, 268661.88979308744, 278900.84174823586, 272403.4040883469, 283685.13661467656, 287966.4542214209, 285468.03150666266, 284138.09972112125, 288452.106897579, 278166.5464614675, 273518.46168933593, 274467.7554457941, 283139.5775514941, 285278.09399825765, 284508.4503305665, 280701.95141824265, 295670.84835304413, 284416.98470493295, 278788.5581962761, 296463.87835147826, 296438.6418224568, 284144.8256888655, 291584.4668328672, 281854.1389832104, 282677.3834890037, 282891.3709102672, 287882.21889913053, 289084.68607864535, 275738.46780335205, 269096.1137467676, 292730.62448214996, 290025.92668607197, 284247.33418173133, 282618.4676668737, 284727.0107841864, 273912.04935460986, 282170.5087472288, 298116.3183046565, 283186.23438543174, 281001.13627324137, 288084.15225292044, 273639.3868978054, 288009.95149560977, 276863.8661387963, 289478.682363008, 291494.05308628496, 280652.58002933953, 287528.2375610933, 290912.84179547656, 298985.5363629407, 280313.4663334677, 292136.18149870844, 284611.7326323762, 287123.08695372153, 287022.08162753255, 292906.1697593994, 281144.7322062797, 289940.58184808807, 285948.4086587001, 274505.9860202952, 277411.91793282994, 285674.9605015452, 286533.5593776683, 290305.2187840313, 284640.56898499315, 275823.4035802776, 276422.60501505074, 279105.8043468043, 263825.39983112074, 271878.0815623053, 294263.37932944176, 303954.78219863086, 295185.67971057625, 295696.45096214506, 288488.2397205222, 293791.5305930178, 286036.16311395745, 277738.29862492334, 270362.4004578444, 270815.80297752493, 285569.3097259236, 275551.836226884, 294969.827756795, 303205.15951340593, 300580.23868374893, 295133.7485837119, 281020.7224918686, 298879.97464133, 276706.54701437923, 293344.1632735839, 286121.28474625765, 270771.4730139078, 298890.12292298145, 280003.64460783947, 279691.8903144797, 288131.8766750472, 272831.2236935052, 290468.28122699197, 279796.79351664573, 273357.45711350633, 266079.749592836, 283504.3859249675, 296390.4963440702, 287632.2036525381, 289658.34014502907, 291294.702805654, 288191.4627130658, 289419.8845238608, 277217.097671783, 278783.56105814525, 290202.70672493166, 301325.1739549358, 282773.6377529892, 276962.8941793475, 274259.29151386983, 266752.4172282759, 284923.4132930036, 289464.50947582116, 264726.2066949917, 274128.0477658742, 276404.1848652389, 276153.2982745786, 291063.64809939766, 274518.9221581178, 286071.6931701183, 305425.39884406544, 288341.5064104907, 286984.6517761588, 282331.343394568, 289607.677097859, 277376.5639876834, 293492.66310395615, 285782.5450732856, 286558.1221953392, 284600.5882318616, 291906.80198156514, 279032.47056850273, 282152.6711741293, 276344.4086234948, 278545.5737884685, 289974.7601896049, 272483.2280948692, 282007.2284237062, 282231.57554188103, 297764.4976846218, 273125.06190371205, 274066.49938182475, 291216.32357357733, 290446.8768247252, 288123.1268871811, 294955.77096917666, 288526.5882256873, 284094.0321295808, 294190.2768222864, 274160.4911441207, 284712.5831187101, 278201.2716998473, 289112.1148494638, 281045.6452920919, 297814.643950586, 275086.64727123466, 286631.8877737509, 290798.2651647265, 295559.8814174545, 289067.1765854491, 286751.66272623045, 293359.20745526766, 258393.22893195687, 285922.6603663709, 280286.3924694084, 302727.1255327133, 284182.13001708203, 289598.7315888854, 281483.01105179166, 276103.8299267578, 276072.84905593266, 265829.9646345259, 276667.31460824166, 279971.70822663733, 277915.13280642283, 294802.9898672533, 288317.9484977569, 282324.4074650557, 285221.8115037386, 283793.1080777324, 264067.24919024925, 277702.86144690047, 293162.06511493545, 282454.0518520813, 293420.8123640507, 303086.089290635, 293244.32422788657, 289821.5810119798, 270604.349540121, 287270.0928814839, 288393.7253053493, 275604.558486651, 282862.48389271565, 284431.02501870814, 266316.2618449591, 266488.9526559939, 285903.571439854, 294080.9640453805, 276428.48840738833, 275092.56945228967, 283311.9098134331, 266441.29530858074, 280855.1480211532, 283780.2488124363, 286564.4449522327, 292732.192851219, 290056.8264046587, 279727.8369763142, 290837.4438461668, 291031.4376673788, 284051.3021700391, 280602.48060881323, 279211.8427270425, 304386.174524858, 292984.70292311336, 281940.8027801164, 296895.6716972133, 287104.66976838675, 289271.7269052018, 278040.75840495003, 281219.7296296674, 270546.49519294273, 281262.1548167126, 294226.87475610484, 297496.1442735364, 283205.6708349079, 281416.9195723424, 296718.75832125964, 286255.7333628732, 285554.69364966167, 273081.00230724784, 279748.38207476505, 272187.63577263546, 273097.19349815074, 280730.8215906945, 300723.3146482583, 274340.77706799604, 315469.11125183373, 279611.83357525564, 279025.49308853113, 288550.6531780086, 273799.4937166807, 281844.31242595724, 269383.34281834826, 289749.50280832633, 282312.68695889827, 276294.3900009386, 301767.6914905405, 289042.7090398922, 289352.60300473624, 286516.6425019342, 279927.7859596446, 280012.5267398427, 296608.30836817133, 286828.3837041727, 285893.7184238884, 277147.66148315335, 285280.97034262156, 284602.7352503238, 279410.95592078636, 278651.57886204374, 275640.22934501985, 262373.019786073, 275209.7282031333, 301513.0178141154, 270617.4751827718, 293183.33588493173, 273947.6623252896, 279766.95427976496, 291063.0332277254, 282636.036482268, 292941.55863181717, 279328.7947138503, 301063.5235677633, 299468.5277646829, 269505.58918634994, 286387.09905869036, 277225.87665013724, 298418.8433117126, 279394.0074473833, 301194.3491907205, 282054.8307590507, 279845.4194174435, 295979.25719346077, 294174.211979517, 305211.54249706346, 275855.2889996379, 295077.76921141794, 281726.84789623873, 286665.9582043357, 274187.62805312115, 287804.9332009139, 287840.0674260679, 292026.344369535, 292875.3028617989, 277804.4267680744, 278930.49650655896, 287723.19567589543, 279025.98444893816, 274263.08929844154, 272551.1434217046, 281189.98534555756, 280461.2250491263, 293420.48634406534, 297949.0475555442, 275133.17191405187, 284583.10497573536, 277730.1200118985, 284592.86945687677, 282924.35578527744, 275442.4300415614, 282122.12642802653, 278691.86626246036, 272685.8555447781, 284049.26530585496, 289486.7081113944, 289995.1397009798, 299522.4203599259, 286131.3601361818, 279523.63669458154, 270547.0524218919, 282255.0543384997, 274385.0540849437, 290085.28970217204, 294485.64155941113, 290602.1036007549, 293344.65204945835, 283277.3658069003, 276377.04131829843, 274143.3198616213, 264037.67300804897, 274550.982401072, 298904.5572217725, 284511.56661117804, 293676.63516478526, 293760.5925550155, 269854.01255343144, 301475.72858518484, 275373.3056219482, 274803.9212975444, 289007.0697692889, 286566.51804801746, 272300.0864980647, 284115.98779881623, 289629.80505030457, 300715.09607467795, 275945.34267740295, 277275.2141789855, 287778.9801641858, 288411.2583003375, 274307.29375192575, 275777.2452111003, 286233.9628290397, 290008.03759050916, 293731.34902829444, 279074.33048943157, 282410.9580568746, 296980.70069762366, 293738.3734782275, 298131.5824960191, 271340.60821307864, 270261.13208156015, 289149.4025869645, 284621.8553672028, 294776.4449333799, 285137.3267652925, 281315.2932706088, 298436.15502380027, 260717.0142318274, 260822.54635085803, 266324.8116125111, 278751.8778532066, 291916.91248885705, 288059.2223991979, 279596.68619359605, 295910.4943781627, 287264.988879735, 299798.5771972472, 296134.03508845647, 290782.5753019326, 290678.0194685824, 279157.7314472079, 272860.1655607353, 281207.0401281305, 289752.8939199157, 274771.8942782078, 285425.88986718125, 295860.9872533554, 287489.475854251, 287424.86146945937, 275118.9358042995, 274649.48128325853, 293534.6376038992, 286885.71763951745, 287646.72639374074, 283323.96674311016, 297836.0284096641, 272479.15144012705, 286510.5290841956, 282256.00966131873, 275887.49403179996, 286047.3169485299, 291291.4897129237, 277786.40640649054, 268071.6743459708, 278282.47760605084, 277908.60104058235, 279026.770629189, 282657.80439409957, 268827.76209171454, 302171.5129198291, 283864.74483534315, 274579.43381255213, 285593.6045430142, 299064.20271491044, 288651.0415323258, 298778.75507112726, 289723.6481923136, 297164.5029053256, 280444.8438438831, 285320.21769221564, 279244.9101232676, 292042.2763987268, 280966.20681837073, 298429.8034156424, 289074.3488924482, 270145.9370717595, 301169.8393487399, 279633.3486384307, 284004.0544423761, 284585.9689198178, 284812.12282697245, 290169.4377755888, 273753.6081760958, 278819.372729699, 283204.45597865083, 292325.24824398773, 282745.32977522083, 267699.3614140401, 278105.85916489264, 272039.4027344011, 281937.9933955713, 282614.05690130993, 269494.7713165958, 295425.9717118009, 299244.5041303933, 275972.83409003617, 285490.38010887156, 288087.19021910144, 278859.168815091, 287189.8039956519, 291210.1150006695, 287761.86365346273, 289312.71397339774, 290929.50723928714, 280943.1910117312, 285509.51679056743, 302565.72754734976, 284207.8206587371, 295752.52733439254, 270836.08401604055, 283975.75406553, 288238.7507887284, 286409.20351923, 291256.7928275823, 293146.8852192049, 292953.60958730296, 296883.87832603644, 289768.313881451, 289335.32521310804, 275883.9393414251, 290541.9961381578, 278309.019053095, 267142.3822991588, 283423.0446583971, 269424.01820014016, 289984.4188717653, 285971.89060295443, 285261.45343008894, 280197.42274842126, 287377.5273166594, 269079.21683295147, 284315.73128258897, 287279.20436608314, 284038.8769573017, 294425.4488654425, 274761.843628207, 279477.1436322903, 270280.12564909476, 287863.0766257174, 281901.45141368615, 279503.1731268147, 288127.6850935905, 294986.7965234333, 275037.65578053636, 283996.3170884755, 277688.1635129474, 290356.2492406242, 290117.26446978335, 285650.8063326604, 294035.9957680787, 298860.8075449856, 290451.56209582376, 293449.8310445912, 287040.17622254346, 267754.2114628623, 292100.2061261845, 293355.94865683484, 281514.00524634187, 276355.3977989117, 292715.4283970012, 285984.123385108, 284647.7022821229, 266615.42693565745, 266242.514918324, 279167.37155777006, 281197.0714999824, 296771.77684122685, 281916.22256354115, 282511.2620606804, 292958.2677503864, 277997.5374099492, 285213.3915807286, 301583.26134668215, 282572.92998963554, 297115.4667413808, 286301.35362809885, 286650.6592161392, 297775.6895834604, 297138.31112228753, 274262.89940671495, 278195.5079800847, 270275.5153145395, 290497.67748718144, 277801.99144745205, 295954.0478213783, 284522.80622311286, 296190.8312415493, 291033.6026264419, 275917.9047889715, 277624.5715131423, 283243.7416113419, 289988.98308829265, 301656.5095771546, 294763.4484343992, 300401.3003014548, 293610.77419814526, 280215.70773325185, 306271.2785771804, 275865.59091009863, 276487.5290926526, 282804.02089024585, 275712.3663837148, 271659.9305359185, 280085.03986509884, 277047.06014925224, 301341.4490769765, 295014.8624250759, 278961.82742192654, 273585.14627883636, 291906.69442674186, 292283.45376573305, 277999.0982052174, 286389.22135295894, 283656.18883046013, 288875.7127150097, 287501.8388166763, 267900.48251652566, 299407.24285200035, 286552.8361701158, 277725.05730235734, 285395.75684114295, 287288.11458324135, 297687.07279283926, 283074.3242642579, 285065.14891854057, 284028.87281357753, 289236.03113942355, 286681.6219111101, 275311.3672677223, 314422.79519557743, 300540.4435108373, 279875.4731382936, 262008.66680522234, 293299.03998514015, 276447.3941173918, 284036.63739989034, 292686.5007097397, 287349.38444176334, 298904.5008350805, 283555.9837240176, 286508.89715662797, 282266.4683550982, 275400.97037309955, 297532.23199857486, 290656.0509686743, 271904.76849590836, 288907.1053042947, 271800.75345585356, 283302.06999165466, 282905.3115116514, 294784.3421000893, 278652.26492464676, 289884.1485148071, 277002.79157722945, 281150.1448523013, 264309.7848576322, 280619.1784281436, 279625.255428033, 292309.6661779562, 289277.21934350603, 289360.4236009984, 289462.8172835308, 281798.1969242271, 297534.0198534123, 275983.3851337151, 284196.809814992, 280639.3576114504, 289259.0528435528, 290621.5052885043, 273913.18579574046, 279509.7931610414, 290464.6603601469, 269214.72603623406, 279920.7636319257, 278685.3959677659, 269427.13313004567, 270101.9124516374, 285075.45780220296, 304627.746023605, 276977.1280971183, 267942.0252713675, 277030.6878470551, 292803.40910160897, 281469.01026536, 293797.9586790197, 287747.9628866731, 279984.7688560232, 276598.1535269141, 281479.41071653675, 276897.9402460006, 275924.39136287884, 277731.1909933387, 293567.0510011277, 278601.6033886209, 279525.6091707167, 291016.71145490964, 295732.9864992336, 280893.772079884, 284452.3178848484, 284542.52877923124, 275661.71302590054, 282124.63808192045, 275340.95735804527, 286429.9651478318, 275794.50178410654, 281037.5698207201, 302183.03856443806, 279696.6300047948, 269680.9964726267, 290860.72119475575, 297674.71315291384, 279698.0093589107, 272699.9348273607, 283064.61471842683, 283040.4322479872, 303680.95144947234, 284623.5936870378, 283189.47360840807, 278872.5675870704, 281025.9060702212, 282309.9204577796, 277818.74731703824, 290301.7615442914, 271841.465538489, 298406.7038286124, 282109.267460706, 275855.5951642044, 279155.75186404504, 283161.1329196903, 295251.6852738519, 284564.2982977431, 282522.5456824469, 297733.16484309215, 280683.80180929607, 292714.07650855643, 278322.9516729462, 288948.4633390964, 280522.9944371578, 288786.04966385016, 281138.7959954341, 287252.8025070427, 279445.15473996516, 277165.74451427214, 282200.5111041846, 283805.4601689491, 268989.40977361955, 272104.0595854369, 276366.58066404663, 278082.235875375, 297265.5238192089, 294976.0603940693, 262192.2786082526, 294961.0421075285, 284153.99797624646, 272996.64150375756, 276386.92423062626, 299348.52794087614, 288699.33534302464, 297984.46068624535, 289614.982124545, 284297.7744952647, 281857.5483570543, 276915.4583508524, 288563.8433154929, 289592.7505805144, 281355.3554454941, 286516.2539294834, 283704.5400155421, 285642.8760037913, 289947.93684023886, 302076.3447089256, 279071.78683679004, 284476.26978595287, 303830.5199514102, 279257.3124162384, 296443.30055057985, 280420.52376600466, 266902.1362675552, 277946.0409962648, 283963.74338037655, 282019.28750084416, 273953.1566398819, 289925.30932776304, 283290.7366810586, 296584.46286441985, 286929.7723162986, 287616.02476138144, 283891.90405877534, 273981.57902692404, 283481.104572315, 268358.9579252327, 283127.1315800158, 294265.89321558183, 276057.0726510013, 294844.6816436649, 269350.55494413414, 282415.79035119375, 287668.39900865493, 274413.8513159413, 285315.6965048097, 264714.79614744947, 279530.8363671081, 299258.6335559538, 289457.0005234282, 284819.2391264847, 272484.29413677496, 267071.64901285304, 291315.2414979349, 283771.6088539756, 290224.39327788644, 275879.73627842887, 297902.55258854013, 299114.9147865538, 289562.3729894913, 271872.4835696691, 285114.13558332453, 276586.9700189565, 296139.45912122197, 277593.10254677385, 290994.87877935014, 292907.6858632272, 281969.5771109566, 277775.8874923552, 269464.7516936708, 270567.694607931, 284881.3042345916, 306773.64649046323, 296141.2302769945, 286402.68053665286, 279081.5193236819, 290828.6891104918, 280478.00535846857, 280296.0115217357, 292344.0210591495, 282581.19473134173, 284013.4212769878, 286207.2842205885, 275725.8003207536, 279416.6715672871, 278831.14843966544, 281560.84080613346, 293597.7306746754, 272602.1607631144, 277580.2640904541, 296295.6235976542, 269142.8397894064, 290054.2644508867, 288235.4998921709, 299896.409259423, 287006.99154413043, 304939.3462872111, 283869.8304367859, 284646.88410802785, 288344.9171177485, 284491.3375473096, 263448.00295211416, 288201.2126427773, 278420.9593937982, 289948.6531263208, 271736.89599496935, 295496.05251861905, 288927.3877017482, 283570.903401636, 280573.46293656924, 279236.2365551586, 279919.477891772, 291101.8286985497, 278603.6608483628, 278600.7216294626, 288710.6978467115, 284141.36075662484, 290596.1343718304, 284369.1048966558, 279837.7093058555, 282928.5236406775, 286817.0520588887, 287005.86082659196, 267765.0710446873, 285618.7272599398, 280134.06317759946, 282112.6830095687, 290067.287079331, 280548.7231552128, 276026.29461287387, 268995.16366718843, 303462.2941385468, 275207.146960231, 280683.2051496735, 286837.1069551228, 294215.4051264762, 291546.18635482556, 280653.15170332347, 296196.09124663915, 264660.23371873953, 273528.33009220683, 292929.1295838396, 286021.49921065714, 278287.5606588409, 284753.41412828787, 294518.4021966199, 294583.753653883, 289387.111926187, 273764.95986759, 286262.6633962351, 283032.9621790361, 282982.1104640631, 291171.5849510531, 286482.7888436231, 282479.60724613315, 283190.7895639096, 274058.1593303482, 302102.3775112649, 281956.205222392, 291299.30836218334, 292953.2846047088, 293897.4664538868, 286399.2638548334, 282131.67095074547, 269536.94758012396, 280142.4706661289, 289299.8250351732, 280940.00297223567, 277691.2781769765, 274948.9329861738, 270577.7324279573, 292983.8225767436, 276305.2547420678, 293501.4702291541, 301412.98876577325, 279054.6828986375, 283237.5645398144, 267177.74891563866, 282789.5855624578, 277268.71245783934, 268773.04125948774]
n = 284689
m = 1024

# === HISTOGRAM ===
plt.hist(estimates, bins=30, edgecolor='black')
#plt.axvline(n, color='red', linestyle='dashed', linewidth=2, label='True count')
plt.title("Histogram of HyperLogLog Estimates")
plt.xlabel("Estimated Cardinality")
plt.ylabel("Frequency")
plt.legend()
plt.grid(False)
plt.tight_layout()
plt.savefig("estimates_histogram.png")  # Save to file
plt.show()

# === STATISTICS ===
estimates = np.array(estimates)
mean_est = np.mean(estimates)
std_est = np.std(estimates)

# Theoretical std deviation of HLL estimate: σ ≈ 1.04 / sqrt(m) * n
sigma = (1.04 / math.sqrt(m)) * n

# Fraction of estimates in n(1 ± kσ)
def fraction_within(k):
    lower = n * (1 - k * sigma / n)
    upper = n * (1 + k * sigma / n)
    count_within = np.sum((estimates >= lower) & (estimates <= upper))
    return count_within / len(estimates)

fractions = {k: fraction_within(k) for k in [1, 2, 3]}

# === PRINT TABLE ===
print("\nSummary Table")
print("=" * 40)
print(f"{'True count (n)':<25}: {n}")
print(f"{'Average estimate':<25}: {mean_est:.2f}")
print(f"{'Standard deviation':<25}: {std_est:.2f}")
print(f"{'Theoretical σ (1.04/sqrt(m))':<25}: {sigma:.2f}")
print("-" * 40)
for k in [1, 2, 3]:
    print(f"Fraction within n(1 ± {k}σ)".ljust(25) + f": {fractions[k]*100:.2f}%")
print("=" * 40)
